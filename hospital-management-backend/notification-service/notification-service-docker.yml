# Notification Service for Docker Compose
# Add this to your main docker-compose.yml

  # Notification Service
  notification-service:
    build:
      context: .
      dockerfile: notification-service/Dockerfile
    image: hospital/notification-service:latest
    container_name: hospital-notification-service
    ports:
      - "3005:3005"
    environment:
      - NODE_ENV=development
      - PORT=3005
      - MONGODB_URI=mongodb://notification_user:notification_password_123@hospital-notification-db:27017/notification_service_db?authSource=admin
      - RABBITMQ_URL=amqp://hospital:hospital_mq_123@hospital-rabbitmq:5672/hospital_vhost
      - NOTIFICATION_QUEUE=notification_queue
      - NOTIFICATION_EXCHANGE=notification_exchange
      - EMAIL_HOST=smtp.gmail.com
      - EMAIL_PORT=587
      - EMAIL_SECURE=false
      - EMAIL_USER=buqcptudw@gmail.com
      - EMAIL_PASSWORD=fakm oirm fwgn cbuf
      - EMAIL_FROM=Hospital Management <noreply@hospital.com>
      - TWILIO_ACCOUNT_SID=your-twilio-account-sid
      - TWILIO_AUTH_TOKEN=your-twilio-auth-token
      - TWILIO_PHONE_NUMBER=+1234567890
      - WEBSOCKET_CORS_ORIGIN=http://localhost:3000
      - SERVICE_NAME=notification-service
      - LOG_LEVEL=info
      - AUTH_SERVICE_URL=http://auth-service:3001
      - PATIENT_SERVICE_URL=http://patient-service:3002
      - APPOINTMENT_SERVICE_URL=http://appointment-service:3003
      - PRESCRIPTION_SERVICE_URL=http://prescription-service:3004
    depends_on:
      notification-db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
      - hospital-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3005/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    volumes:
      # Mount logs for debugging
      - ./notification-service/logs:/app/logs
